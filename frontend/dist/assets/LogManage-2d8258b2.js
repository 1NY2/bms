import{_ as j,m as A,z as M,p as $,k as p,x as J,o as E,c as N,b as R,q as e,s as t,d as Q,l as U,E as X,A as Z,f as u,t as i,e as h}from"./index-0403a620.js";import{l as z}from"./index-8cce7ed6.js";const ee={class:"log-manage"},ae={class:"search-section"},te={class:"time-range-section"},le={key:0,class:"log-details"},oe={style:{background:"#f5f5f5",padding:"10px","border-radius":"4px","white-space":"pre-wrap"}},ne={style:{background:"#f5f5f5",padding:"10px","border-radius":"4px","white-space":"pre-wrap"}},se={__name:"LogManage",setup(re){const C=A([]),w=A(!1),T=A(!1),r=A(null),o=M({keyword:"",logType:"",action:"",status:"",timeRange:null}),d=M({currentPage:1,pageSize:20,total:0}),_=async()=>{w.value=!0;try{let s={};if(o.keyword){const a=await z.searchLogs(o.keyword),m=a&&a.data;C.value=m&&Array.isArray(m.data)?m.data:[],d.total=C.value.length}else{const a=await z.getAllLogs(),m=a&&a.data;let y=m&&Array.isArray(m.data)?m.data:[],l=Array.isArray(y)?y:[];if(o.logType&&(l=l.filter(f=>f.logType===o.logType)),o.action&&(l=l.filter(f=>f.action===o.action)),o.status&&(l=l.filter(f=>f.status===o.status)),o.timeRange&&o.timeRange.length===2){const[f,D]=o.timeRange;l=l.filter(c=>{const S=new Date(c.createTime).getTime();return S>=new Date(f).getTime()&&S<=new Date(D).getTime()})}d.total=l.length;const v=(d.currentPage-1)*d.pageSize,b=v+d.pageSize;C.value=Array.isArray(l)?l.slice(v,b):[]}}catch(s){console.error("获取日志失败:",s),X.error("获取日志失败: "+s.message)}finally{w.value=!1}},P=()=>{o.keyword="",o.logType="",o.action="",o.status="",o.timeRange=null,d.currentPage=1,_()},x=s=>{d.pageSize=s,d.currentPage=1,_()},F=s=>{d.currentPage=s,_()},G=s=>{r.value=s,T.value=!0},H=()=>{T.value=!1,r.value=null},O=s=>s?new Date(s).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"",I=s=>({PURCHASE:"primary",USER_AUTH:"success",ORDER_ACCESS:"warning",ORDER_MANAGE:"danger",USER_INFO:"info",USER_ASSETS:"warning",WORKFLOW:"primary",ATOMIC_SERVICE:"info"})[s]||"info",V=s=>({PURCHASE:"购买操作",USER_AUTH:"用户认证",ORDER_ACCESS:"订单访问",ORDER_MANAGE:"订单管理",USER_INFO:"用户信息",USER_ASSETS:"用户资产",WORKFLOW:"工作流",ATOMIC_SERVICE:"原子服务"})[s]||s,L=s=>({SUCCESS:"success",FAILED:"danger",PROCESSING:"warning"})[s]||"info",k=s=>({SUCCESS:"成功",FAILED:"失败",PROCESSING:"处理中"})[s]||s;return $(()=>{_()}),(s,a)=>{const m=p("el-input"),y=p("el-col"),l=p("el-option"),v=p("el-select"),b=p("el-button"),f=p("el-row"),D=p("el-date-picker"),c=p("el-table-column"),S=p("el-tag"),W=p("el-table"),K=p("el-pagination"),g=p("el-descriptions-item"),B=p("el-descriptions"),Y=p("el-dialog"),q=J("loading");return E(),N("div",ee,[a[11]||(a[11]=R("h2",null,"日志管理",-1)),R("div",ae,[e(f,{gutter:20},{default:t(()=>[e(y,{span:6},{default:t(()=>[e(m,{modelValue:o.keyword,"onUpdate:modelValue":a[0]||(a[0]=n=>o.keyword=n),placeholder:"搜索日志内容",clearable:"",onKeyup:Z(_,["enter"])},null,8,["modelValue"])]),_:1}),e(y,{span:4},{default:t(()=>[e(v,{modelValue:o.logType,"onUpdate:modelValue":a[1]||(a[1]=n=>o.logType=n),placeholder:"日志类型",clearable:"",onChange:_},{default:t(()=>[e(l,{label:"购买操作",value:"PURCHASE"}),e(l,{label:"用户认证",value:"USER_AUTH"}),e(l,{label:"订单访问",value:"ORDER_ACCESS"}),e(l,{label:"订单管理",value:"ORDER_MANAGE"}),e(l,{label:"用户信息",value:"USER_INFO"}),e(l,{label:"用户资产",value:"USER_ASSETS"}),e(l,{label:"工作流",value:"WORKFLOW"}),e(l,{label:"原子服务",value:"ATOMIC_SERVICE"})]),_:1},8,["modelValue"])]),_:1}),e(y,{span:4},{default:t(()=>[e(v,{modelValue:o.action,"onUpdate:modelValue":a[2]||(a[2]=n=>o.action=n),placeholder:"操作类型",clearable:"",onChange:_},{default:t(()=>[e(l,{label:"购买产品",value:"PURCHASE_PRODUCT"}),e(l,{label:"用户登录",value:"USER_LOGIN"}),e(l,{label:"用户注册",value:"USER_REGISTER"}),e(l,{label:"获取订单",value:"GET_USER_ORDERS"}),e(l,{label:"更新订单",value:"UPDATE_ORDER_STATUS"}),e(l,{label:"取消订单",value:"CANCEL_ORDER"})]),_:1},8,["modelValue"])]),_:1}),e(y,{span:4},{default:t(()=>[e(v,{modelValue:o.status,"onUpdate:modelValue":a[3]||(a[3]=n=>o.status=n),placeholder:"状态",clearable:"",onChange:_},{default:t(()=>[e(l,{label:"成功",value:"SUCCESS"}),e(l,{label:"失败",value:"FAILED"}),e(l,{label:"处理中",value:"PROCESSING"})]),_:1},8,["modelValue"])]),_:1}),e(y,{span:6},{default:t(()=>[e(b,{type:"primary",onClick:_},{default:t(()=>[...a[8]||(a[8]=[u("搜索",-1)])]),_:1}),e(b,{onClick:P},{default:t(()=>[...a[9]||(a[9]=[u("重置",-1)])]),_:1})]),_:1})]),_:1})]),R("div",te,[e(D,{modelValue:o.timeRange,"onUpdate:modelValue":a[4]||(a[4]=n=>o.timeRange=n),type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间","value-format":"YYYY-MM-DD HH:mm:ss",onChange:_},null,8,["modelValue"])]),Q((E(),U(W,{data:C.value,style:{width:"100%"},border:"",stripe:""},{default:t(()=>[e(c,{prop:"id",label:"ID",width:"80"}),e(c,{prop:"logType",label:"日志类型",width:"120"},{default:t(({row:n})=>[e(S,{type:I(n.logType),size:"small"},{default:t(()=>[u(i(V(n.logType)),1)]),_:2},1032,["type"])]),_:1}),e(c,{prop:"action",label:"操作类型",width:"150"}),e(c,{prop:"userId",label:"用户ID",width:"150"}),e(c,{prop:"productCode",label:"产品编码",width:"120"}),e(c,{prop:"orderNo",label:"订单号",width:"180"}),e(c,{prop:"content",label:"日志内容","min-width":"200","show-overflow-tooltip":""}),e(c,{prop:"status",label:"状态",width:"100"},{default:t(({row:n})=>[e(S,{type:L(n.status),size:"small"},{default:t(()=>[u(i(k(n.status)),1)]),_:2},1032,["type"])]),_:1}),e(c,{prop:"createTime",label:"创建时间",width:"160"},{default:t(({row:n})=>[u(i(O(n.createTime)),1)]),_:1}),e(c,{label:"操作",width:"150"},{default:t(({row:n})=>[e(b,{type:"primary",size:"small",onClick:ue=>G(n)},{default:t(()=>[...a[10]||(a[10]=[u(" 详情 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[q,w.value]]),e(K,{"current-page":d.currentPage,"onUpdate:currentPage":a[5]||(a[5]=n=>d.currentPage=n),"page-size":d.pageSize,"onUpdate:pageSize":a[6]||(a[6]=n=>d.pageSize=n),"page-sizes":[10,20,50,100],total:d.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:x,onCurrentChange:F,style:{"margin-top":"20px","text-align":"right"}},null,8,["current-page","page-size","total"]),e(Y,{modelValue:T.value,"onUpdate:modelValue":a[7]||(a[7]=n=>T.value=n),title:"日志详情",width:"80%","before-close":H},{default:t(()=>[r.value?(E(),N("div",le,[e(B,{column:2,border:""},{default:t(()=>[e(g,{label:"ID"},{default:t(()=>[u(i(r.value.id),1)]),_:1}),e(g,{label:"日志类型"},{default:t(()=>[e(S,{type:I(r.value.logType),size:"small"},{default:t(()=>[u(i(V(r.value.logType)),1)]),_:1},8,["type"])]),_:1}),e(g,{label:"操作类型"},{default:t(()=>[u(i(r.value.action),1)]),_:1}),e(g,{label:"用户ID"},{default:t(()=>[u(i(r.value.userId),1)]),_:1}),e(g,{label:"产品编码"},{default:t(()=>[u(i(r.value.productCode),1)]),_:1}),e(g,{label:"订单号"},{default:t(()=>[u(i(r.value.orderNo),1)]),_:1}),e(g,{label:"状态"},{default:t(()=>[e(S,{type:L(r.value.status),size:"small"},{default:t(()=>[u(i(k(r.value.status)),1)]),_:1},8,["type"])]),_:1}),e(g,{label:"创建时间"},{default:t(()=>[u(i(O(r.value.createTime)),1)]),_:1}),e(g,{label:"IP地址",span:2},{default:t(()=>[u(i(r.value.ipAddress||"N/A"),1)]),_:1}),e(g,{label:"日志内容",span:2},{default:t(()=>[u(i(r.value.content),1)]),_:1}),r.value.requestParams?(E(),U(g,{key:0,label:"请求参数",span:2},{default:t(()=>[R("pre",oe,i(r.value.requestParams),1)]),_:1})):h("",!0),r.value.responseResult?(E(),U(g,{key:1,label:"响应结果",span:2},{default:t(()=>[R("pre",ne,i(r.value.responseResult),1)]),_:1})):h("",!0)]),_:1})])):h("",!0)]),_:1},8,["modelValue"])])}}},pe=j(se,[["__scopeId","data-v-57d30dcb"]]);export{pe as default};
