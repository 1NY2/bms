import{a as u}from"./index-8cce7ed6.js";import{_ as f,o,c as d,b as s,n as k,t as i,e as m,d as v,v as g}from"./index-0403a620.js";const h={name:"OrderDetail",data(){return{order:null,loading:!1,isEditingRemark:!1,editedRemark:"",savingRemark:!1,showCancelConfirmFlag:!1,cancellingOrder:!1}},computed:{canCancelOrder(){return this.order?this.order.status==="PENDING"||this.order.status==="PROCESSING":!1}},created(){this.loadOrderDetail()},methods:{async loadOrderDetail(){const r=this.$route.params.orderNo;if(!r){this.$router.back();return}this.loading=!0;try{const e=await u.getOrderDetail(r);this.order=e&&e.data||null,this.order&&(this.editedRemark=this.order.remark||"")}catch(e){console.error("加载订单详情失败",e),alert("加载订单详情失败: "+e.message)}finally{this.loading=!1}},getOrderStatusText(r){return{PENDING:"待支付",PROCESSING:"处理中",SUCCESS:"已完成",FAILED:"已失败",CANCELLED:"已取消"}[r]||r},formatCurrency(r){return parseFloat(r).toFixed(2).replace(/\d(?=(\d{3})+\.)/g,"$&,")},formatDateTime(r){if(!r)return"";const e=new Date(r),l=e.getFullYear(),c=String(e.getMonth()+1).padStart(2,"0"),t=String(e.getDate()).padStart(2,"0"),a=String(e.getHours()).padStart(2,"0"),n=String(e.getMinutes()).padStart(2,"0");return`${l}-${c}-${t} ${a}:${n}`},formatDate(r){if(!r)return"";const e=new Date(r),l=e.getFullYear(),c=String(e.getMonth()+1).padStart(2,"0"),t=String(e.getDate()).padStart(2,"0");return`${l}-${c}-${t}`},startEditRemark(){this.isEditingRemark=!0,this.editedRemark=this.order.remark||""},cancelEditRemark(){this.isEditingRemark=!1,this.editedRemark=this.order.remark||""},async saveRemark(){if(!this.savingRemark){this.savingRemark=!0;try{const r=await u.updateOrderRemark(this.order.orderNo,this.editedRemark);r&&r.data&&r.data.success?(this.order.remark=this.editedRemark,this.isEditingRemark=!1,alert(r.data.message||"备注保存成功")):alert(r&&r.data?r.data.message:"备注保存失败")}catch(r){console.error("保存备注失败",r),alert("保存备注失败: "+r.message)}finally{this.savingRemark=!1}}},showCancelConfirm(){this.showCancelConfirmFlag=!0},hideCancelConfirm(){this.showCancelConfirmFlag=!1},async confirmCancelOrder(){if(!this.cancellingOrder){this.cancellingOrder=!0;try{const r=localStorage.getItem("userInfo");if(!r)throw new Error("用户未登录");const e=JSON.parse(r),l=await u.cancelOrder(this.order.orderNo,e.userId);l&&l.data&&l.data.success?(this.order.status="CANCELLED",this.order.updateTime=new Date().toISOString(),this.order.endDate=new Date().toISOString(),this.hideCancelConfirm(),alert(l.data.message||"订单取消成功，资金已退回您的账户")):alert(l&&l.data?l.data.message:"订单取消失败")}catch(r){console.error("取消订单失败",r),alert("取消订单失败: "+r.message)}finally{this.cancellingOrder=!1}}}}},C={class:"order-detail-page"},_={class:"header"},p={key:0,class:"loading"},b={key:1,class:"content"},R={class:"status-card"},y={class:"status-text"},D={class:"info-card"},S={class:"detail-item"},O={class:"value order-no"},E={class:"detail-item"},w={class:"value"},N={class:"detail-item"},I={class:"value"},x={class:"detail-item"},T={class:"value"},F={class:"detail-item"},M={class:"value"},L={class:"detail-item"},A={class:"value income"},G={class:"info-card"},P={class:"detail-item"},B={class:"value"},V={class:"detail-item"},U={class:"value"},Y={class:"detail-item"},z={class:"value"},H={key:0,class:"detail-item"},J={class:"value"},j={class:"info-card"},q={key:0,class:"remark-content"},K={key:0},Q={key:1,class:"no-remark"},W={key:1,class:"remark-edit-form"},X={class:"remark-count"},Z={class:"remark-actions"},$=["disabled"],ee={key:0,class:"action-buttons"},se={key:2,class:"modal-overlay"},te={class:"modal-content confirm-modal"},re={class:"modal-header"},ae={class:"modal-body"},ie={class:"modal-footer"},ne=["disabled"];function le(r,e,l,c,t,a){return o(),d("div",C,[s("div",_,[s("div",{class:"back-btn",onClick:e[0]||(e[0]=n=>r.$router.back())},[...e[9]||(e[9]=[s("span",null,"<",-1)])]),e[10]||(e[10]=s("h1",{class:"title"},"订单详情",-1)),e[11]||(e[11]=s("div",{class:"header-placeholder"},null,-1))]),t.loading?(o(),d("div",p,"加载中...")):t.order?(o(),d("div",b,[s("div",R,[s("div",{class:k(["status-icon",t.order.status])},i(a.getOrderStatusText(t.order.status)),3),s("div",y,i(a.getOrderStatusText(t.order.status)),1)]),s("div",D,[e[18]||(e[18]=s("div",{class:"card-title"},"基本信息",-1)),s("div",S,[e[12]||(e[12]=s("span",{class:"label"},"订单号",-1)),s("span",O,i(t.order.orderNo),1)]),s("div",E,[e[13]||(e[13]=s("span",{class:"label"},"产品名称",-1)),s("span",w,i(t.order.productName),1)]),s("div",N,[e[14]||(e[14]=s("span",{class:"label"},"购买金额",-1)),s("span",I,"¥"+i(a.formatCurrency(t.order.amount)),1)]),s("div",x,[e[15]||(e[15]=s("span",{class:"label"},"年化利率",-1)),s("span",T,i(t.order.annualRate)+"%",1)]),s("div",F,[e[16]||(e[16]=s("span",{class:"label"},"存款期限",-1)),s("span",M,i(t.order.duration)+"天",1)]),s("div",L,[e[17]||(e[17]=s("span",{class:"label"},"预期收益",-1)),s("span",A,"¥"+i(a.formatCurrency(t.order.expectedIncome)),1)])]),s("div",G,[e[23]||(e[23]=s("div",{class:"card-title"},"时间信息",-1)),s("div",P,[e[19]||(e[19]=s("span",{class:"label"},"起息日期",-1)),s("span",B,i(a.formatDate(t.order.startDate)),1)]),s("div",V,[e[20]||(e[20]=s("span",{class:"label"},"到期日期",-1)),s("span",U,i(a.formatDate(t.order.endDate)),1)]),s("div",Y,[e[21]||(e[21]=s("span",{class:"label"},"下单时间",-1)),s("span",z,i(a.formatDateTime(t.order.createTime)),1)]),t.order.updateTime?(o(),d("div",H,[e[22]||(e[22]=s("span",{class:"label"},"更新时间",-1)),s("span",J,i(a.formatDateTime(t.order.updateTime)),1)])):m("",!0)]),s("div",j,[e[24]||(e[24]=s("div",{class:"card-title"},"备注信息",-1)),t.isEditingRemark?(o(),d("div",W,[v(s("textarea",{"onUpdate:modelValue":e[2]||(e[2]=n=>t.editedRemark=n),placeholder:"请输入备注信息",class:"remark-input",maxlength:"200",rows:"3"},null,512),[[g,t.editedRemark]]),s("div",X,i(t.editedRemark.length)+"/200",1),s("div",Z,[s("button",{class:"cancel-btn",onClick:e[3]||(e[3]=(...n)=>a.cancelEditRemark&&a.cancelEditRemark(...n))},"取消"),s("button",{class:"save-btn",onClick:e[4]||(e[4]=(...n)=>a.saveRemark&&a.saveRemark(...n)),disabled:t.savingRemark},i(t.savingRemark?"保存中...":"保存"),9,$)])])):(o(),d("div",q,[t.order.remark?(o(),d("div",K,i(t.order.remark),1)):(o(),d("div",Q,"暂无备注")),s("button",{class:"edit-remark-btn",onClick:e[1]||(e[1]=(...n)=>a.startEditRemark&&a.startEditRemark(...n))},"编辑备注")]))]),a.canCancelOrder?(o(),d("div",ee,[s("button",{class:"cancel-order-btn",onClick:e[5]||(e[5]=(...n)=>a.showCancelConfirm&&a.showCancelConfirm(...n))},"取消订单")])):m("",!0)])):m("",!0),t.showCancelConfirmFlag?(o(),d("div",se,[s("div",te,[s("div",re,[e[25]||(e[25]=s("h3",null,"确认取消订单",-1)),s("button",{class:"modal-close",onClick:e[6]||(e[6]=(...n)=>a.hideCancelConfirm&&a.hideCancelConfirm(...n))},"×")]),s("div",ae,[e[26]||(e[26]=s("p",null,"您确定要取消此订单吗？",-1)),s("p",null,"订单号："+i(t.order.orderNo),1),s("p",null,"产品名称："+i(t.order.productName),1),s("p",null,"购买金额：¥"+i(a.formatCurrency(t.order.amount)),1),e[27]||(e[27]=s("p",{class:"warning-text"},"取消后资金将退回您的账户",-1))]),s("div",ie,[s("button",{class:"btn-cancel",onClick:e[7]||(e[7]=(...n)=>a.hideCancelConfirm&&a.hideCancelConfirm(...n))},"取消"),s("button",{class:"btn-confirm btn-danger",onClick:e[8]||(e[8]=(...n)=>a.confirmCancelOrder&&a.confirmCancelOrder(...n)),disabled:t.cancellingOrder},i(t.cancellingOrder?"取消中...":"确认取消"),9,ne)])])])):m("",!0)])}const ce=f(h,[["render",le],["__scopeId","data-v-a82c4b1f"]]);export{ce as default};
