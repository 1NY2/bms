import{a as p}from"./index-8cce7ed6.js";import{_ as O,o as i,c as n,b as e,d as g,g as v,h,v as S,F as b,r as y,t as o,e as c,n as f,f as _}from"./index-0403a620.js";const w={name:"OrderManage",data(){return{orders:[],loading:!1,showStatusModalFlag:!1,showDetailModal:!1,selectedOrder:{},newStatus:"",updatingStatus:!1,filterStatus:"",filterUserId:"",filterOrderNo:"",currentPage:1,pageSize:10,totalOrders:0}},computed:{filteredOrders(){let s=Array.isArray(this.orders)?this.orders:[];return console.log("过滤前的订单数据:",s.length),this.filterStatus&&(s=s.filter(t=>t.status===this.filterStatus)),this.filterUserId&&(s=s.filter(t=>t.userId.includes(this.filterUserId))),this.filterOrderNo&&(s=s.filter(t=>t.orderNo.includes(this.filterOrderNo))),console.log("过滤后的订单数据:",s.length),s},paginatedOrders(){const s=Array.isArray(this.filteredOrders)?this.filteredOrders:[];console.log("分页前的数据:",s.length);const t=(this.currentPage-1)*this.pageSize,d=t+this.pageSize,u=s.slice(t,d);return console.log("分页后的数据:",u.length),u},totalPages(){const s=Array.isArray(this.filteredOrders)?this.filteredOrders:[],t=Math.ceil(s.length/this.pageSize);return console.log("总页数:",t),t}},created(){this.loadOrders()},methods:{async loadOrders(){this.loading=!0;try{const s=await p.getAllOrders(),t=s&&s.data,d=t&&t.data||[];this.orders=Array.isArray(d)?d:[],this.totalOrders=this.orders.length}catch(s){console.error("加载订单列表失败",s),alert("加载订单列表失败: "+s.message),this.orders=[]}finally{this.loading=!1}},resetFilters(){this.filterStatus="",this.filterUserId="",this.filterOrderNo="",this.currentPage=1,this.loadOrders()},changePage(s){this.currentPage=s},async viewOrderDetail(s){try{const t=await p.getOrderDetail(s.orderNo),d=t&&t.data;this.selectedOrder=d&&d.data||{},this.showDetailModal=!0}catch(t){console.error("获取订单详情失败",t),alert("获取订单详情失败: "+t.message)}},closeDetailModal(){this.showDetailModal=!1,this.selectedOrder={}},showStatusModal(s){this.selectedOrder=s,this.newStatus=s.status,this.showStatusModalFlag=!0},closeStatusModal(){this.showStatusModalFlag=!1,this.selectedOrder={},this.newStatus=""},async updateOrderStatus(){if(!this.updatingStatus){if(!this.newStatus){alert("请选择新的订单状态");return}this.updatingStatus=!0;try{const s=await p.updateOrderStatus(this.selectedOrder.orderNo,this.newStatus),t=s&&s.data;t&&t.success?alert(t.message||"订单状态更新成功"):alert(t?t.message:"订单状态更新成功");const d=this.orders.findIndex(u=>u.orderNo===this.selectedOrder.orderNo);d>-1&&(this.orders[d].status=this.newStatus,this.orders[d].updateTime=new Date().toISOString()),this.closeStatusModal()}catch(s){console.error("更新订单状态失败",s),alert("更新订单状态失败: "+s.message)}finally{this.updatingStatus=!1}}},getOrderStatusText(s){return{PENDING:"待支付",PROCESSING:"处理中",SUCCESS:"成功",FAILED:"失败",CANCELLED:"已取消"}[s]||s},formatCurrency(s){return parseFloat(s).toFixed(2).replace(/\d(?=(\d{3})+\.)/g,"$&,")},formatDate(s){if(!s)return"";const t=new Date(s),d=t.getFullYear(),u=String(t.getMonth()+1).padStart(2,"0"),l=String(t.getDate()).padStart(2,"0"),a=String(t.getHours()).padStart(2,"0"),r=String(t.getMinutes()).padStart(2,"0");return`${d}-${u}-${l} ${a}:${r}`},formatDateTime(s){return this.formatDate(s)}}},D={class:"order-manage"},C={class:"filter-section"},N={class:"filter-item"},I={class:"filter-item"},M={class:"filter-item"},k={class:"table-container"},P={class:"order-table"},E={key:0},x={key:1},A=["onClick"],U=["onClick","disabled"],F={key:0,class:"pagination"},T=["disabled"],L={class:"page-info"},V=["disabled"],G={key:1,class:"modal-overlay"},z={class:"modal-content detail-modal"},R={class:"modal-header"},B={key:0,class:"modal-body"},H={class:"detail-section"},Y={class:"detail-row"},j={class:"value"},q={class:"detail-row"},J={class:"value"},K={class:"detail-row"},Q={class:"value"},W={class:"detail-row"},X={class:"value"},Z={class:"detail-row"},$={class:"value"},tt={class:"detail-row"},et={class:"value"},st={class:"detail-row"},lt={class:"value income"},rt={class:"detail-section"},at={class:"detail-row"},ot={class:"value"},dt={key:0,class:"detail-row"},it={class:"value"},nt={class:"detail-section"},ut={class:"detail-row"},ct={class:"value"},gt={key:0,class:"detail-section"},pt={class:"detail-row"},ft={class:"value remark"},vt={key:2,class:"modal-overlay"},ht={class:"modal-content"},St={class:"modal-header"},mt={class:"modal-body"},Ot={class:"form-group"},bt={class:"modal-footer"},yt=["disabled"];function _t(s,t,d,u,l,a){return i(),n("div",D,[t[39]||(t[39]=e("div",{class:"page-header"},[e("h2",null,"订单管理"),e("p",{class:"page-desc"},"查看和管理所有用户订单")],-1)),e("div",C,[e("div",N,[t[14]||(t[14]=e("label",{for:"filterStatus"},"订单状态：",-1)),g(e("select",{id:"filterStatus","onUpdate:modelValue":t[0]||(t[0]=r=>l.filterStatus=r),onChange:t[1]||(t[1]=(...r)=>a.loadOrders&&a.loadOrders(...r))},[...t[13]||(t[13]=[h('<option value="" data-v-8742716b>全部</option><option value="PENDING" data-v-8742716b>待支付</option><option value="PROCESSING" data-v-8742716b>处理中</option><option value="SUCCESS" data-v-8742716b>成功</option><option value="FAILED" data-v-8742716b>失败</option><option value="CANCELLED" data-v-8742716b>已取消</option>',6)])],544),[[v,l.filterStatus]])]),e("div",I,[t[15]||(t[15]=e("label",{for:"filterUserId"},"用户ID：",-1)),g(e("input",{type:"text",id:"filterUserId","onUpdate:modelValue":t[2]||(t[2]=r=>l.filterUserId=r),placeholder:"请输入用户ID"},null,512),[[S,l.filterUserId]])]),e("div",M,[t[16]||(t[16]=e("label",{for:"filterOrderNo"},"订单号：",-1)),g(e("input",{type:"text",id:"filterOrderNo","onUpdate:modelValue":t[3]||(t[3]=r=>l.filterOrderNo=r),placeholder:"请输入订单号"},null,512),[[S,l.filterOrderNo]])]),e("button",{class:"btn-search",onClick:t[4]||(t[4]=(...r)=>a.loadOrders&&a.loadOrders(...r))},"搜索"),e("button",{class:"btn-reset",onClick:t[5]||(t[5]=(...r)=>a.resetFilters&&a.resetFilters(...r))},"重置")]),e("div",k,[e("table",P,[t[19]||(t[19]=e("thead",null,[e("tr",null,[e("th",null,"订单号"),e("th",null,"用户ID"),e("th",null,"产品名称"),e("th",null,"购买金额"),e("th",null,"预期收益"),e("th",null,"下单时间"),e("th",null,"订单状态"),e("th",null,"操作")])],-1)),e("tbody",null,[l.loading?(i(),n("tr",E,[...t[17]||(t[17]=[e("td",{colspan:"8",class:"loading"},"加载中...",-1)])])):a.paginatedOrders.length===0?(i(),n("tr",x,[...t[18]||(t[18]=[e("td",{colspan:"8",class:"empty"},"暂无订单数据",-1)])])):(i(!0),n(b,{key:2},y(a.paginatedOrders,r=>(i(),n("tr",{key:r.id},[e("td",null,o(r.orderNo),1),e("td",null,o(r.userId),1),e("td",null,o(r.productName),1),e("td",null,"¥"+o(a.formatCurrency(r.amount)),1),e("td",null,"¥"+o(a.formatCurrency(r.expectedIncome)),1),e("td",null,o(a.formatDate(r.createTime)),1),e("td",null,[e("span",{class:f(["status-badge",r.status])},o(a.getOrderStatusText(r.status)),3)]),e("td",null,[e("button",{class:"btn-action btn-detail",onClick:m=>a.viewOrderDetail(r)},"详情",8,A),e("button",{class:"btn-action btn-status",onClick:m=>a.showStatusModal(r),disabled:r.status==="SUCCESS"}," 修改状态 ",8,U)])]))),128))])])]),a.totalPages>1?(i(),n("div",F,[e("button",{class:"btn-page",disabled:l.currentPage===1,onClick:t[6]||(t[6]=r=>a.changePage(l.currentPage-1))}," 上一页 ",8,T),e("span",L," 第 "+o(l.currentPage)+" 页，共 "+o(a.totalPages)+" 页 ",1),e("button",{class:"btn-page",disabled:l.currentPage===a.totalPages,onClick:t[7]||(t[7]=r=>a.changePage(l.currentPage+1))}," 下一页 ",8,V)])):c("",!0),l.showDetailModal?(i(),n("div",G,[e("div",z,[e("div",R,[t[20]||(t[20]=e("h3",null,"订单详情",-1)),e("button",{class:"modal-close",onClick:t[8]||(t[8]=(...r)=>a.closeDetailModal&&a.closeDetailModal(...r))},"×")]),l.selectedOrder?(i(),n("div",B,[e("div",H,[t[28]||(t[28]=e("h4",null,"基本信息",-1)),e("div",Y,[t[21]||(t[21]=e("span",{class:"label"},"订单号：",-1)),e("span",j,o(l.selectedOrder.orderNo),1)]),e("div",q,[t[22]||(t[22]=e("span",{class:"label"},"用户ID：",-1)),e("span",J,o(l.selectedOrder.userId),1)]),e("div",K,[t[23]||(t[23]=e("span",{class:"label"},"产品名称：",-1)),e("span",Q,o(l.selectedOrder.productName),1)]),e("div",W,[t[24]||(t[24]=e("span",{class:"label"},"购买金额：",-1)),e("span",X,"¥"+o(a.formatCurrency(l.selectedOrder.amount)),1)]),e("div",Z,[t[25]||(t[25]=e("span",{class:"label"},"年化利率：",-1)),e("span",$,o(l.selectedOrder.annualRate)+"%",1)]),e("div",tt,[t[26]||(t[26]=e("span",{class:"label"},"存款期限：",-1)),e("span",et,o(l.selectedOrder.duration)+"天",1)]),e("div",st,[t[27]||(t[27]=e("span",{class:"label"},"预期收益：",-1)),e("span",lt,"¥"+o(a.formatCurrency(l.selectedOrder.expectedIncome)),1)])]),e("div",rt,[t[31]||(t[31]=e("h4",null,"时间信息",-1)),e("div",at,[t[29]||(t[29]=e("span",{class:"label"},"下单时间：",-1)),e("span",ot,o(a.formatDateTime(l.selectedOrder.createTime)),1)]),l.selectedOrder.updateTime?(i(),n("div",dt,[t[30]||(t[30]=e("span",{class:"label"},"更新时间：",-1)),e("span",it,o(a.formatDateTime(l.selectedOrder.updateTime)),1)])):c("",!0)]),e("div",nt,[t[33]||(t[33]=e("h4",null,"状态信息",-1)),e("div",ut,[t[32]||(t[32]=e("span",{class:"label"},"订单状态：",-1)),e("span",ct,[e("span",{class:f(["status-badge-inline",l.selectedOrder.status])},o(a.getOrderStatusText(l.selectedOrder.status)),3)])])]),l.selectedOrder.remark?(i(),n("div",gt,[t[34]||(t[34]=e("h4",null,"备注信息",-1)),e("div",pt,[e("span",ft,o(l.selectedOrder.remark),1)])])):c("",!0)])):c("",!0)])])):c("",!0),l.showStatusModalFlag?(i(),n("div",vt,[e("div",ht,[e("div",St,[t[35]||(t[35]=e("h3",null,"修改订单状态",-1)),e("button",{class:"modal-close",onClick:t[9]||(t[9]=(...r)=>a.closeStatusModal&&a.closeStatusModal(...r))},"×")]),e("div",mt,[e("p",null,"订单号："+o(l.selectedOrder.orderNo),1),e("p",null,[t[36]||(t[36]=_("当前状态： ",-1)),e("span",{class:f(["status-badge-inline",l.selectedOrder.status])},o(a.getOrderStatusText(l.selectedOrder.status)),3)]),e("div",Ot,[t[38]||(t[38]=e("label",{for:"newStatus"},"新状态：",-1)),g(e("select",{id:"newStatus","onUpdate:modelValue":t[10]||(t[10]=r=>l.newStatus=r)},[...t[37]||(t[37]=[h('<option value="PENDING" data-v-8742716b>待支付</option><option value="PROCESSING" data-v-8742716b>处理中</option><option value="SUCCESS" data-v-8742716b>成功</option><option value="FAILED" data-v-8742716b>失败</option><option value="CANCELLED" data-v-8742716b>已取消</option>',5)])],512),[[v,l.newStatus]])])]),e("div",bt,[e("button",{class:"btn-cancel",onClick:t[11]||(t[11]=(...r)=>a.closeStatusModal&&a.closeStatusModal(...r))},"取消"),e("button",{class:"btn-confirm",onClick:t[12]||(t[12]=(...r)=>a.updateOrderStatus&&a.updateOrderStatus(...r)),disabled:l.updatingStatus},o(l.updatingStatus?"更新中...":"确认更新"),9,yt)])])])):c("",!0)])}const Ct=O(w,[["render",_t],["__scopeId","data-v-8742716b"]]);export{Ct as default};
