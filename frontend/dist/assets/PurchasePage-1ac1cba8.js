import{p as A,a as I}from"./index-8cce7ed6.js";import{_ as S,o as a,c as u,b as e,t as r,F as g,r as y,d as c,i as v,j as _,f as k,w as b,v as f,e as p,n as h,h as C}from"./index-0403a620.js";const w={name:"PurchasePage",data(){return{loading:!1,submitting:!1,product:null,userId:"",amount:"",expectedIncome:0,totalAmount:0,captcha:"",agreedToTerms:!1,finalAgreed:!1,currentStep:0,steps:["产品确认","金额输入","信息确认","确认购买"],isCaptchaSending:!1,countdown:60,countdownTimer:null,showAgreementModal:!1,showHelpModal:!1,amountError:"",userIdError:"",captchaError:"",remark:"",quickAmounts:[1e4,5e4,1e5,5e5]}},created(){this.loadProductDetail()},beforeUnmount(){this.countdownTimer&&clearInterval(this.countdownTimer)},methods:{async loadProductDetail(){this.loading=!0;try{const l=this.$route.params.code,s=await A.getProductDetail(l);this.product=s.data&&s.data.data||null,this.product&&(this.amount=this.product.minAmount,this.calculateIncome())}catch(l){console.error("加载产品详情失败",l),this.$router.back()}finally{this.loading=!1}},calculateIncome(){if(!this.amount||!this.product){this.expectedIncome=0,this.totalAmount=0;return}const l=parseFloat(this.amount),s=parseFloat(this.product.annualRate)/100,i=this.product.duration;this.expectedIncome=l*s*i/365,this.totalAmount=l+this.expectedIncome,this.amountError=""},selectQuickAmount(l){this.amount=l,this.calculateIncome()},onAmountFocus(){},onAmountBlur(){this.validateAmount()},validateAmount(){if(this.amountError="",!this.amount||parseFloat(this.amount)<=0)return this.amountError="请输入有效的存入金额",!1;const l=parseFloat(this.amount);if(l<parseFloat(this.product.minAmount))return this.amountError=`存入金额不能低于起存金额${this.product.minAmount}元`,!1;const s=l-parseFloat(this.product.minAmount),i=parseFloat(this.product.incrementAmount);return s>0&&s%i!==0?(this.amountError=`存入金额必须是${i}元的整数倍`,!1):l>parseFloat(this.product.personLimit)?(this.amountError=`存入金额不能超过单人限额${this.product.personLimit}元`,!1):!0},sendCaptcha(){if(!this.isCaptchaSending){if(!this.userId.trim()){this.userIdError="请输入用户ID";return}this.userIdError="",this.isCaptchaSending=!0,this.countdown=60,this.countdownTimer=setInterval(()=>{this.countdown--,this.countdown<=0&&(this.isCaptchaSending=!1,clearInterval(this.countdownTimer))},1e3),setTimeout(()=>{alert("验证码已发送，请使用测试验证码：123456")},500)}},showAgreement(){this.showAgreementModal=!0},closeAgreement(){this.showAgreementModal=!1},agreeToAgreement(){this.agreedToTerms=!0,this.closeAgreement()},showHelp(){this.showHelpModal=!0},closeHelp(){this.showHelpModal=!1},prevStep(){this.currentStep>0&&this.currentStep--},nextStep(){switch(this.currentStep){case 0:if(!this.agreedToTerms){alert("请先阅读并同意产品购买协议");return}break;case 1:if(!this.validateAmount())return;break;case 2:if(!this.validateUserInfo())return;break;case 3:if(!this.finalAgreed){alert("请确认购买信息无误");return}this.confirmPurchase();return}this.currentStep<this.steps.length-1&&this.currentStep++},validateUserInfo(){return this.userIdError="",this.captchaError="",this.userId.trim()?this.captcha.trim()?this.captcha!=="123456"?(this.captchaError="验证码错误",!1):!0:(this.captchaError="请输入验证码",!1):(this.userIdError="请输入用户ID",!1)},async confirmPurchase(){this.submitting=!0;try{const l=await I.purchaseProduct({userId:this.userId.trim(),productCode:this.product.productCode,amount:parseFloat(this.amount),remark:this.remark.trim()});if(l&&l.data){const s=l.data;if(s&&typeof s=="object"&&s.code===500&&s.data){const i=s.data;if(i&&i.success===!1){const d=i.message||"未知错误",t=i.errorType||"PURCHASE_ERROR";this.$router.push({name:"PurchaseSuccess",query:{result:encodeURIComponent(JSON.stringify({success:!1,message:d,errorType:t}))}})}}else if(s&&s.success===!1){const i=s.message||"未知错误",d=s.errorType||"PURCHASE_ERROR";this.$router.push({name:"PurchaseSuccess",query:{result:encodeURIComponent(JSON.stringify({success:!1,message:i,errorType:d}))}})}else this.$router.push({name:"PurchaseSuccess",query:{result:encodeURIComponent(JSON.stringify(s.data||s))}})}else this.$router.push({name:"PurchaseSuccess",query:{result:encodeURIComponent(JSON.stringify({success:!1,message:"购买失败：未收到有效响应",errorType:"PURCHASE_ERROR"}))}})}catch(l){console.error("购买失败",l);let s="购买失败: "+(l.message||"未知错误"),i="NETWORK_ERROR";if(l.response&&l.response.data){const d=l.response.data;d.message&&(s=d.message),d.data&&d.data.errorType?i=d.data.errorType:d.errorType&&(i=d.errorType)}this.$router.push({name:"PurchaseSuccess",query:{result:encodeURIComponent(JSON.stringify({success:!1,message:s,errorType:i}))}})}finally{this.submitting=!1}}}},T={class:"purchase-page"},E={class:"header"},x={class:"title"},R={key:0,class:"loading"},P={key:1,class:"content"},F={class:"steps-indicator"},U={class:"step-number"},H={class:"step-label"},D={class:"step-content"},M={class:"product-info-card"},N={class:"info-grid"},O={class:"info-item"},V={class:"value"},B={class:"info-item"},q={class:"value highlight"},J={class:"info-item"},L={class:"value"},j={class:"info-item"},Q={class:"value"},z={class:"info-item"},K={class:"value"},W={class:"info-item"},G={class:"value"},X={class:"agreement-section"},Y={class:"checkbox-label"},Z={class:"step-content"},$={class:"amount-card"},ss={class:"amount-input-wrapper"},es={class:"quick-amounts"},ts=["onClick"],os={class:"amount-tips"},rs={key:0,class:"error-message"},ns={key:0,class:"income-card"},ls={class:"income-row"},is={class:"income-value"},as={class:"income-row"},us={class:"income-value total"},ds={class:"step-content"},cs={class:"user-card"},ps={class:"user-form"},ms={class:"form-group"},hs={key:0,class:"error-message"},vs={class:"form-group"},fs={class:"captcha-wrapper"},bs=["disabled"],gs={key:0,class:"error-message"},ys={class:"step-content"},_s={class:"summary-card"},ks={class:"summary-grid"},As={class:"summary-item"},Is={class:"value"},Ss={class:"summary-item"},Cs={class:"value"},ws={class:"summary-item"},Ts={class:"value"},Es={class:"summary-item"},xs={class:"value income"},Rs={class:"summary-item"},Ps={class:"value"},Fs={class:"remark-card"},Us={class:"remark-form"},Hs={class:"remark-count"},Ds={class:"agreement-section"},Ms={class:"checkbox-label"},Ns={class:"notice-card"},Os={class:"notice-list"},Vs={class:"notice-item"},Bs={class:"notice-item"},qs={class:"notice-item"},Js={class:"notice-item"},Ls={class:"bottom-bar"},js=["disabled"],Qs={class:"modal-header"},zs={class:"modal-footer"},Ks={class:"modal-header"};function Ws(l,s,i,d,t,n){return a(),u("div",T,[e("div",E,[e("div",{class:"back-btn",onClick:s[0]||(s[0]=o=>l.$router.back())},[...s[22]||(s[22]=[e("span",null,"<",-1)])]),e("h1",x,r(t.product?t.product.productName:"产品购买"),1),e("div",{class:"help-btn",onClick:s[1]||(s[1]=(...o)=>n.showHelp&&n.showHelp(...o))},[...s[23]||(s[23]=[e("span",null,"?",-1)])])]),t.loading?(a(),u("div",R,"加载中...")):t.product?(a(),u("div",P,[e("div",F,[(a(!0),u(g,null,y(t.steps,(o,m)=>(a(),u("div",{key:m,class:h(["step",{active:t.currentStep===m,completed:t.currentStep>m}])},[e("div",U,r(m+1),1),e("div",H,r(o),1)],2))),128))]),c(e("div",D,[e("div",M,[s[30]||(s[30]=e("div",{class:"card-header"},[e("h3",null,"产品信息确认")],-1)),e("div",N,[e("div",O,[s[24]||(s[24]=e("span",{class:"label"},"产品名称",-1)),e("span",V,r(t.product.productName),1)]),e("div",B,[s[25]||(s[25]=e("span",{class:"label"},"年化利率",-1)),e("span",q,r(t.product.annualRate)+"%",1)]),e("div",J,[s[26]||(s[26]=e("span",{class:"label"},"存款期限",-1)),e("span",L,r(t.product.durationDesc),1)]),e("div",j,[s[27]||(s[27]=e("span",{class:"label"},"起存金额",-1)),e("span",Q,r(t.product.minAmount)+"元",1)]),e("div",z,[s[28]||(s[28]=e("span",{class:"label"},"递增金额",-1)),e("span",K,r(t.product.incrementAmount)+"元",1)]),e("div",W,[s[29]||(s[29]=e("span",{class:"label"},"剩余额度",-1)),e("span",G,r(t.product.inventory)+"份",1)])])]),e("div",X,[e("label",Y,[c(e("input",{type:"checkbox","onUpdate:modelValue":s[2]||(s[2]=o=>t.agreedToTerms=o),class:"checkbox"},null,512),[[_,t.agreedToTerms]]),s[31]||(s[31]=k(" 我已阅读并同意",-1)),e("a",{href:"#",onClick:s[3]||(s[3]=b((...o)=>n.showAgreement&&n.showAgreement(...o),["prevent"]))},"《产品购买协议》")])])],512),[[v,t.currentStep===0]]),c(e("div",Z,[e("div",$,[s[33]||(s[33]=e("div",{class:"card-header"},[e("h3",null,"存入金额")],-1)),e("div",ss,[s[32]||(s[32]=e("span",{class:"currency"},"¥",-1)),c(e("input",{type:"number","onUpdate:modelValue":s[4]||(s[4]=o=>t.amount=o),placeholder:"请输入存入金额",class:"amount-input",onInput:s[5]||(s[5]=(...o)=>n.calculateIncome&&n.calculateIncome(...o)),onFocus:s[6]||(s[6]=(...o)=>n.onAmountFocus&&n.onAmountFocus(...o)),onBlur:s[7]||(s[7]=(...o)=>n.onAmountBlur&&n.onAmountBlur(...o))},null,544),[[f,t.amount]])]),e("div",es,[(a(!0),u(g,null,y(t.quickAmounts,o=>(a(),u("div",{key:o,class:h(["quick-amount",{active:t.amount==o}]),onClick:m=>n.selectQuickAmount(o)},r(o)+"元 ",11,ts))),128))]),e("div",os," 起存"+r(t.product.minAmount)+"元，"+r(t.product.incrementAmount)+"元递增 ",1),t.amountError?(a(),u("div",rs,r(t.amountError),1)):p("",!0)]),t.expectedIncome>0?(a(),u("div",ns,[e("div",ls,[s[34]||(s[34]=e("span",{class:"label"},"预期收益",-1)),e("span",is,"¥ "+r(t.expectedIncome.toFixed(2)),1)]),e("div",as,[s[35]||(s[35]=e("span",{class:"label"},"到期本息",-1)),e("span",us,"¥ "+r(t.totalAmount.toFixed(2)),1)])])):p("",!0)],512),[[v,t.currentStep===1]]),c(e("div",ds,[e("div",cs,[s[38]||(s[38]=e("div",{class:"card-header"},[e("h3",null,"用户信息确认")],-1)),e("div",ps,[e("div",ms,[s[36]||(s[36]=e("label",null,"用户ID *",-1)),c(e("input",{type:"text","onUpdate:modelValue":s[8]||(s[8]=o=>t.userId=o),placeholder:"请输入用户ID（如：13800138000）",class:h(["form-input",{error:t.userIdError}])},null,2),[[f,t.userId]]),t.userIdError?(a(),u("div",hs,r(t.userIdError),1)):p("",!0)]),e("div",vs,[s[37]||(s[37]=e("label",null,"验证码",-1)),e("div",fs,[c(e("input",{type:"text","onUpdate:modelValue":s[9]||(s[9]=o=>t.captcha=o),placeholder:"请输入验证码",class:h(["form-input captcha-input",{error:t.captchaError}])},null,2),[[f,t.captcha]]),e("button",{class:h(["captcha-btn",{disabled:t.isCaptchaSending}]),onClick:s[10]||(s[10]=(...o)=>n.sendCaptcha&&n.sendCaptcha(...o)),disabled:t.isCaptchaSending},r(t.isCaptchaSending?`${t.countdown}秒后重发`:"发送验证码"),11,bs)]),t.captchaError?(a(),u("div",gs,r(t.captchaError),1)):p("",!0)])]),s[39]||(s[39]=e("div",{class:"tips"},[e("p",null,"· 测试账号：13800138000 或 13900139000"),e("p",null,"· 验证码统一为：123456")],-1))])],512),[[v,t.currentStep===2]]),c(e("div",ys,[e("div",_s,[s[45]||(s[45]=e("div",{class:"card-header"},[e("h3",null,"购买信息确认")],-1)),e("div",ks,[e("div",As,[s[40]||(s[40]=e("span",{class:"label"},"产品名称",-1)),e("span",Is,r(t.product.productName),1)]),e("div",Ss,[s[41]||(s[41]=e("span",{class:"label"},"年化利率",-1)),e("span",Cs,r(t.product.annualRate)+"%",1)]),e("div",ws,[s[42]||(s[42]=e("span",{class:"label"},"存入金额",-1)),e("span",Ts,"¥ "+r(t.amount),1)]),e("div",Es,[s[43]||(s[43]=e("span",{class:"label"},"预期收益",-1)),e("span",xs,"¥ "+r(t.expectedIncome.toFixed(2)),1)]),e("div",Rs,[s[44]||(s[44]=e("span",{class:"label"},"用户ID",-1)),e("span",Ps,r(t.userId),1)])])]),e("div",Fs,[s[46]||(s[46]=e("div",{class:"card-header"},[e("h3",null,"备注信息")],-1)),e("div",Us,[c(e("textarea",{"onUpdate:modelValue":s[11]||(s[11]=o=>t.remark=o),placeholder:"请输入备注信息（可选）",class:"remark-input",maxlength:"200",rows:"3"},null,512),[[f,t.remark]]),e("div",Hs,r(t.remark.length)+"/200",1)])]),e("div",Ds,[e("label",Ms,[c(e("input",{type:"checkbox","onUpdate:modelValue":s[12]||(s[12]=o=>t.finalAgreed=o),class:"checkbox"},null,512),[[_,t.finalAgreed]]),s[47]||(s[47]=k(" 我确认以上信息无误，同意进行购买操作 ",-1))])])],512),[[v,t.currentStep===3]]),e("div",Ns,[s[53]||(s[53]=e("div",{class:"card-header"},[e("h3",null,"购买须知")],-1)),e("div",Os,[e("div",Vs,[s[48]||(s[48]=e("span",{class:"dot"},"·",-1)),e("span",null,"存款起存金额："+r(t.product.minAmount)+"元，支持"+r(t.product.incrementAmount)+"元递增",1)]),e("div",Bs,[s[49]||(s[49]=e("span",{class:"dot"},"·",-1)),e("span",null,"单人购买限额："+r(t.product.personLimit)+"元",1)]),e("div",qs,[s[50]||(s[50]=e("span",{class:"dot"},"·",-1)),e("span",null,"单日购买限额："+r(t.product.dailyLimit)+"元",1)]),s[52]||(s[52]=e("div",{class:"notice-item"},[e("span",{class:"dot"},"·"),e("span",null,"每日22:00前存入，当日起息（含节假日）")],-1)),e("div",Js,[s[51]||(s[51]=e("span",{class:"dot"},"·",-1)),e("span",null,"产品剩余额度："+r(t.product.inventory)+"份，先到先得",1)])])]),e("div",Ls,[t.currentStep>0?(a(),u("button",{key:0,class:"prev-btn",onClick:s[13]||(s[13]=(...o)=>n.prevStep&&n.prevStep(...o))}," 上一步 ")):p("",!0),e("button",{class:"next-btn",onClick:s[14]||(s[14]=(...o)=>n.nextStep&&n.nextStep(...o)),disabled:t.submitting},r(t.currentStep===t.steps.length-1?t.submitting?"提交中...":"确认购买":"下一步"),9,js)])])):p("",!0),t.showAgreementModal?(a(),u("div",{key:2,class:"modal-overlay",onClick:s[18]||(s[18]=(...o)=>n.closeAgreement&&n.closeAgreement(...o))},[e("div",{class:"modal-content",onClick:s[17]||(s[17]=b(()=>{},["stop"]))},[e("div",Qs,[s[54]||(s[54]=e("h3",null,"产品购买协议",-1)),e("button",{class:"close-btn",onClick:s[15]||(s[15]=(...o)=>n.closeAgreement&&n.closeAgreement(...o))},"×")]),s[55]||(s[55]=e("div",{class:"modal-body"},[e("p",null,"这是产品购买协议的内容..."),e("p",null,"用户在购买本产品前应仔细阅读并理解以下条款："),e("ol",null,[e("li",null,"本产品为银行存款产品，受存款保险保护"),e("li",null,"用户需确保提供的信息真实、准确、完整"),e("li",null,"购买成功后资金将在一个工作日内划转"),e("li",null,"产品收益按约定利率计算，到期一次性支付"),e("li",null,"用户可在产品到期前申请提前支取，但可能影响收益")])],-1)),e("div",zs,[e("button",{class:"agree-btn",onClick:s[16]||(s[16]=(...o)=>n.agreeToAgreement&&n.agreeToAgreement(...o))},"我已阅读并同意")])])])):p("",!0),t.showHelpModal?(a(),u("div",{key:3,class:"modal-overlay",onClick:s[21]||(s[21]=(...o)=>n.closeHelp&&n.closeHelp(...o))},[e("div",{class:"modal-content help-modal",onClick:s[20]||(s[20]=b(()=>{},["stop"]))},[e("div",Ks,[s[56]||(s[56]=e("h3",null,"购买帮助",-1)),e("button",{class:"close-btn",onClick:s[19]||(s[19]=(...o)=>n.closeHelp&&n.closeHelp(...o))},"×")]),s[57]||(s[57]=C('<div class="modal-body" data-v-3b502b3f><div class="help-section" data-v-3b502b3f><h4 data-v-3b502b3f>如何购买产品？</h4><p data-v-3b502b3f>1. 确认产品信息</p><p data-v-3b502b3f>2. 输入购买金额</p><p data-v-3b502b3f>3. 确认用户信息</p><p data-v-3b502b3f>4. 阅读并同意协议</p><p data-v-3b502b3f>5. 提交购买申请</p></div><div class="help-section" data-v-3b502b3f><h4 data-v-3b502b3f>注意事项</h4><p data-v-3b502b3f>· 购买前请确保账户余额充足</p><p data-v-3b502b3f>· 购买金额需符合起存和递增要求</p><p data-v-3b502b3f>· 购买成功后不可撤销</p></div></div>',1))])])):p("",!0)])}const Ys=S(w,[["render",Ws],["__scopeId","data-v-3b502b3f"]]);export{Ys as default};
