import{c as w}from"./index-8cce7ed6.js";import{_ as B,m as c,p as N,k as n,x as P,o as C,c as S,b as v,d as z,l as K,s as l,q as s,E as d,f as u,t as m,y as O}from"./index-0403a620.js";const q={class:"user-manage"},R={class:"user-table-container"},j={class:"dialog-footer"},F={__name:"UserManage",setup(G){const y=c([]),g=c(!1),i=c(!1),p=c(""),_=c(""),h=async()=>{g.value=!0;try{const e=await w.getAllUsers();e.data&&e.data.success?y.value=e.data.data:d.error((e.data?e.data.message:"")||"获取用户列表失败")}catch(e){d.error("获取用户列表失败: "+e.message)}finally{g.value=!1}},A=e=>{const a=e.status==="ACTIVE"?"LOCKED":"ACTIVE",o=e.status==="ACTIVE"?"禁用":"启用";O.confirm(`确定要${o}用户 ${e.username} 吗？`,"确认操作",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const r=await w.updateUserStatus(e.username,a);r.data&&r.data.success?(d.success((r.data?r.data.message:"")||`${o}用户成功`),e.status=a):d.error((r.data?r.data.message:"")||`${o}用户失败`)}catch(r){d.error(`${o}用户失败: `+r.message)}}).catch(()=>{})},D=e=>{p.value=e,_.value="",i.value=!0},T=async()=>{try{const e=await w.resetUserPassword(p.value,_.value||void 0);e.data&&e.data.success?(d.success((e.data?e.data.message:"")||"重置密码成功"),i.value=!1):d.error((e.data?e.data.message:"")||"重置密码失败")}catch(e){d.error("重置密码失败: "+e.message)}},x=e=>{switch(e){case"ACTIVE":return"success";case"LOCKED":return"warning";case"DELETED":return"danger";default:return"info"}},U=e=>{switch(e){case"ACTIVE":return"正常";case"LOCKED":return"已锁定";case"DELETED":return"已删除";default:return e}},b=e=>{if(!e)return"";try{return new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).replace(/\//g,"-")}catch{return e}};return N(()=>{h()}),(e,a)=>{const o=n("el-table-column"),r=n("el-tag"),f=n("el-button"),k=n("el-table"),E=n("el-input"),V=n("el-form-item"),I=n("el-form"),L=n("el-dialog"),M=P("loading");return C(),S("div",q,[a[7]||(a[7]=v("h2",null,"用户管理",-1)),v("div",R,[z((C(),K(k,{data:y.value,style:{width:"100%"}},{default:l(()=>[s(o,{prop:"username",label:"用户名",width:"120"}),s(o,{prop:"realName",label:"真实姓名",width:"120"}),s(o,{prop:"phone",label:"手机号",width:"120"}),s(o,{prop:"email",label:"邮箱",width:"180"}),s(o,{prop:"role",label:"角色",width:"100"},{default:l(t=>[s(r,{type:t.row.role==="ADMIN"?"danger":"primary"},{default:l(()=>[u(m(t.row.role==="ADMIN"?"管理员":"普通用户"),1)]),_:2},1032,["type"])]),_:1}),s(o,{prop:"status",label:"状态",width:"100"},{default:l(t=>[s(r,{type:x(t.row.status)},{default:l(()=>[u(m(U(t.row.status)),1)]),_:2},1032,["type"])]),_:1}),s(o,{prop:"createdAt",label:"创建时间",width:"180"},{default:l(t=>[u(m(b(t.row.createdAt)),1)]),_:1}),s(o,{prop:"lastLoginAt",label:"最后登录",width:"180"},{default:l(t=>[u(m(t.row.lastLoginAt?b(t.row.lastLoginAt):"从未登录"),1)]),_:1}),s(o,{label:"操作",width:"200",fixed:"right"},{default:l(t=>[s(f,{size:"small",type:t.row.status==="ACTIVE"?"warning":"success",onClick:$=>A(t.row)},{default:l(()=>[u(m(t.row.status==="ACTIVE"?"禁用":"启用"),1)]),_:2},1032,["type","onClick"]),s(f,{size:"small",type:"info",onClick:$=>D(t.row.username)},{default:l(()=>[...a[4]||(a[4]=[u(" 重置密码 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[M,g.value]])]),s(L,{modelValue:i.value,"onUpdate:modelValue":a[3]||(a[3]=t=>i.value=t),title:"重置密码",width:"400px"},{footer:l(()=>[v("span",j,[s(f,{onClick:a[2]||(a[2]=t=>i.value=!1)},{default:l(()=>[...a[5]||(a[5]=[u("取消",-1)])]),_:1}),s(f,{type:"primary",onClick:T},{default:l(()=>[...a[6]||(a[6]=[u("确认重置",-1)])]),_:1})])]),default:l(()=>[s(I,null,{default:l(()=>[s(V,{label:"用户名"},{default:l(()=>[s(E,{modelValue:p.value,"onUpdate:modelValue":a[0]||(a[0]=t=>p.value=t),disabled:""},null,8,["modelValue"])]),_:1}),s(V,{label:"新密码"},{default:l(()=>[s(E,{modelValue:_.value,"onUpdate:modelValue":a[1]||(a[1]=t=>_.value=t),type:"password",placeholder:"请输入新密码，留空则使用默认密码123456"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}},Q=B(F,[["__scopeId","data-v-6d6db967"]]);export{Q as default};
